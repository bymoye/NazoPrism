---
import { ViewTransitions } from "astro:transitions";

export interface Props {
  title?: string;
  description?: string;
}

const { title = "Sakura_re", description = "沉淪在無盡的深淵中..." } =
  Astro.props;
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <title>{title}</title>
    <ViewTransitions />
  </head>
  <body>
    <!-- 背景轮播容器 - 整个容器都被持久化 -->
    <div
      id="background-carousel-container"
      transition:persist="background-carousel"
    >
      <div
        id="bg-layer-1"
        style="position:fixed;width:108%;height:108%;top:-5%;left:-5%;background-size:cover;background-position:center;background-repeat:no-repeat;z-index:-1000;opacity:0;pointer-events:none;"
      >
      </div>
      <div
        id="bg-layer-2"
        style="position:fixed;width:108%;height:108%;top:-5%;left:-5%;background-size:cover;background-position:center;background-repeat:no-repeat;z-index:-1000;opacity:0;pointer-events:none;"
      >
      </div>

      <!-- 内联脚本，作为容器的一部分被持久化 -->
      <script>
        import { initBackgroundCarousel } from "../scripts/background-carousel";
        import { SITE_CONFIG } from "../config";

        // 扩展 Window 接口
        declare global {
          interface Window {
            BACKGROUND_CAROUSEL_INITIALIZED?: boolean;
          }
        }

        // 检查是否已经初始化
        if (!window.BACKGROUND_CAROUSEL_INITIALIZED) {
          window.BACKGROUND_CAROUSEL_INITIALIZED = true;

          // 使用配置中的背景图片
          const backgrounds = SITE_CONFIG.backgroundApi.fallbackImages;
          initBackgroundCarousel(backgrounds);
        }
      </script>
    </div>

    <slot />
  </body>
</html>

<style is:global>
  @import "../styles/global.css";
</style>
