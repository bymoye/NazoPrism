---
// ToTop button component
---

<div id="to-top" class="go_top">
  <i class="back_top_svg"></i>
</div>

<script>
  import { initToTop } from '../scripts/to-top';

  // 初始化
  initToTop();

  // 监听 Astro 页面加载事件
  document.addEventListener('astro:page-load', () => {
    initToTop();
  });
</script>

<style>
  /* Material Design 3 FAB (Floating Action Button) */
  .go_top {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 99;
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    outline: none;
    cursor: pointer;
    border-radius: var(--md-sys-shape-corner-large);
    transform: scale(0);
    transition:
      transform var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized),
      background-color var(--md-sys-motion-duration-theme) var(--md-sys-motion-easing-emphasized),
      color var(--md-sys-motion-duration-theme) var(--md-sys-motion-easing-emphasized),
      box-shadow var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized);

    /* Pure M3 FAB */
    background: rgb(var(--md-sys-color-primary));
    color: rgb(var(--md-sys-color-on-primary));
    border: none;
    box-shadow: var(--md-sys-elevation-level3);
    overflow: hidden;
  }

  /* Anime-style glow effect */
  .go_top::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
      45deg,
      transparent 30%,
      rgba(255, 255, 255, 0.2) 50%,
      transparent 70%
    );
    transition: transform var(--md-sys-motion-duration-medium4)
      var(--md-sys-motion-easing-emphasized);
  }

  /* Show state */
  .go_top.show {
    transform: scale(1);
  }

  .go_top.show::before {
    transform: rotate(-45deg) translateX(100%);
  }

  /* Hover state - Pure M3 */
  .go_top:hover {
    transform: scale(1.1) translateY(-2px);
    background: rgb(var(--md-sys-color-primary-container));
    color: rgb(var(--md-sys-color-on-primary-container));
    box-shadow: var(--md-sys-elevation-level4);
  }

  .go_top:hover::before {
    transform: rotate(-45deg) translateX(200%);
  }

  /* Active state */
  .go_top:active {
    transform: scale(0.95);
    box-shadow: var(--md-sys-elevation-level1);
  }

  /* Focus visible */
  .go_top:focus-visible {
    outline: 2px solid var(--md-sys-color-primary);
    outline-offset: 2px;
  }

  /* Icon styling */
  .back_top_svg {
    --svg_backtop: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z' fill='currentColor'/%3E%3C/svg%3E");
    --size: 24px;
    width: var(--size);
    height: var(--size);
    display: inline-block;
    background-color: currentColor;
    mask-image: var(--svg_backtop);
    -webkit-mask-image: var(--svg_backtop);
    mask-size: contain;
    -webkit-mask-size: contain;
    mask-repeat: no-repeat;
    -webkit-mask-repeat: no-repeat;
    mask-position: center;
    -webkit-mask-position: center;
    transition: transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-standard);
  }

  /* Icon animation on hover */
  .go_top:hover .back_top_svg {
    transform: translateY(-2px);
  }

  /* 移除重复的 ::before 定义，使用上面的 anime-style glow effect */

  /* Extended FAB variant (optional, can be toggled with class) */
  .go_top.extended {
    width: auto;
    padding: 0 20px;
    gap: 8px;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .go_top {
      bottom: 16px;
      right: 16px;
      width: 48px;
      height: 48px;
    }

    .back_top_svg {
      --size: 20px;
    }
  }

  /* Dark mode adjustments */
  @media (prefers-color-scheme: dark) {
    .go_top {
      background: rgba(var(--md-sys-color-primary-container), 0.8);
      color: var(--md-sys-color-on-primary-container);
    }

    .go_top:hover {
      background: rgba(var(--md-sys-color-primary-container), 0.9);
    }
  }

  /* Accessibility - Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .go_top {
      transition-duration: 0.01ms;
    }

    .back_top_svg {
      transition-duration: 0.01ms;
    }
  }
</style>
